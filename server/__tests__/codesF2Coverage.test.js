const { parsePageContent } = require('../parsePageContent');

describe('codesF2.txt coverage in raw.txt and parsePageContent', () => {
  test('все коды, которые присутствуют в raw.txt, спарсены parsePageContent', () => {
    const codes = ['1110', '1120', '1130', '1140', '1150', '11501', '11502', '1160', '1170', '11701', '1180', '1190', '1100', '1210', '12101', '12102', '12103', '1220', '12201', '12202', '1230', '12301', '12302', '12303', '12304', '12305', '1240', '12401', '1250', '12501', '12502', '1260', '12601', '1200', '1600', '1310', '1320', '1340', '1350', '1360', '1370', '1300', '1410', '1420', '1430', '1440', '1450', '1400', '1510', '15101', '1520', '15201', '15202', '15203', '15204', '15205', '15206', '15207', '1530', '1540', '1550', '1500', '1700', '2110', '2120', '2100', '2210', '2200', '2310', '2320', '2330', '2340', '23401', '23402', '23403', '23404', '23405', '23406', '2350', '23501', '23502', '23503', '23504', '23505', '23506', '23507', '23508', '23509', '2300', '2410', '2411', '2412', '2460', '2400', '2510', '2520', '2530', '2500', '2900', '2910'];
    
    // Данные из raw.txt
    const rawStrings = [
      ['Бухгалтерский баланс', 'на 31 марта 2024 г.', 'Коды', 'Форма по ОКУД', '0710001', 'Дата (число, месяц, год)', '31', '03', '2024', 'Организация', 'Акционерное общество "ПРОммОНТАЖСТРОЙ"', 'по ОКПО', '57932545', 'Идентификационный номер налогоплательщика', 'IHH', '7805235431', 'Вид экономической', 'Работы строительные специализированные, не включенные в', 'по', 'деятельности', 'ОКвэд 2', '43.99.5', 'другие группировки', 'Организационно-правовая форма/форма собственности', 'Непубличные акционерные', '12267', '16', 'общества', '/Частная собственность', 'по ОКОПФ / ОКФС', 'Единица измерения:', 'в тыс. рублей', 'по ОКЕИ', '384', 'Местонахождение (адрес)', '191180, Санкт-Петербург г, Гороховая ул, дом 67, литера А, помещение 14Н', 'Бухгалтерская отчетность подлежит обязательному аудиту', 'ДА', 'HET', 'Наименование аудиторской организации/фамилия, имя, отчество (при наличии) индивидуального аудитора', 'Идентификационный номер налогоплательщика аудиторской организации/индивидуального', 'ИHH', 'аудитора', 'Основной государственный регистрационный номер аудиторской', 'ОГРН/', 'организации/индивидуального аудитора', 'ОГРНИП', 'На 31 марта', 'На 31 декабря', 'На 31 декабря', 'Пояснения', 'Наименование показателя', 'Код', '2024.', '2023г.', '2022г.', 'АКТИВ', 'I. ВНЕОБОРОТНЫЕ АКТИВЫ', 'Нематериальные активы', '1110', '-', '-', 'Результаты исследований и разработок', '1120', '-', '-', '-', 'Нематериальные поисковые активы', '1130', '-', '-', '-', 'Материальные поисковые активы', '1140', '-', '-', 'Основные средства', '1150', '23692', '24 100', '26 048', 'в том числе:', 'Основные средства в организации', '11501', '18 692', '19100', '21 048', 'Права пользования активами', '11502', '5000', '5000', '5000', 'Доходные вложения в материальные', '1160', 'ценности', '-', '-', 'Финансовые вложения', '1170', '95653', '95 653', '95653', 'в том числе:', 'Паи', '11701', '95653', '95 653', '95 653', 'Отложенные налоговые активы', '1180', '-', '-', '-', 'Прочие внеоборотные активы', '1190', '-', '-', '-', 'Итого по разделу I', '1100', '119345', '119 753', '121701', 'II. ОБОРОТНЫЕ АКТИВЫ', 'Запасы', '1210', '1241 669', '919 272', '852699', 'в том числе:', 'Материалы', '12101', '83 038', '78 834', '78 580', 'Товары', '12102', '5467', '5467', '188', 'Основное производство', '12103', '1 153 164', '834 971', '773931', 'Налог на добавленную стоимость по', '1220', 'приобретенным ценностям', '-', '-', '723', 'в том числе:', 'НДС по приобретенным', '12201', 'материально-производственным запасам', '-', '696', '-'],
      ['НДС по приобретенным услугам', '12202', '-', '-', '27', 'Дебиторская задолженность', '1230', '1641 863', '1 450 868', '1417123', 'в том числе:', 'Расчеты с поставщиками и подрядчиками', '12301', '1342448', '1 120 054', '762 725', 'Расчеты с покупателями и заказчиками', '12302', '244 238', '288 733', '619211', 'Расчеты по налогам и сборам', '12303', '4627', '228', '877', 'Расчеты с персоналом по прочим', '12304', 'операциям', '550', '550', '550', 'Расчеты с разными дебиторами и', '12305', 'кредиторами', '50 000', '41303', '33 760', 'Финансовые вложения (за исключением', '1240', 'денежных эквивалентов)', '80 526', '78 926', '49 926', 'в том числе:', 'Предоставленные займы', '12401', '80 526', '78 926', '49 926', 'Денежные средства и денежные', '1250', 'эквиваленты', '454 630', '470 108', '309 607', 'в том числе:', 'Расчетные счета', '12501', '451392', '467 390', '309 489', 'Прочие специальные счета', '12502', '3238', '2718', '118', 'Прочие оборотные активы', '1260', '18 495', '21082', '61652', 'в том числе:', 'Расходы будущих периодов', '12601', '18 495', '21082', '61652', 'Итого по разделу I', '1200', '3 437 183', '2 940 256', '2691730', '5ААHC', '1600', '3 556 528', '3 060 009', '2813431'],
      ['Форма 0710001 с.2', 'Пояснения', 'Наименование показателя', 'Код', 'На 31 марта 2024', 'На 31 декабря', 'На 31 декабря', 'г.', '2023г.', '2022r.', 'ПАССИВ', 'III. КАПИТАЛ И РЕЗЕРВЫ', 'Уставный капитал(складочный капитал,', 'уставный фонд, вклады товарищей)', '1310', '210', '210', '210', 'Собственные акции, выкупленные у', '1320', 'акционеров', 'Переоценка внеоборотных активов', '-', '1340', '-', '-', 'Добавочный капитал (без переоценки)', '-', '-', '1350', '372100', '372 100', '372100', 'Резервный капитал', '1360', 'Нераспределенная прибыль(непокрытый', '-', '-', '-', 'убыток)', '1370', '37 070', '32 628', '28623', 'Итого по разделу II', '1300', '409380', '404 938', '400 933', 'ИV. ДОЛГОСРОЧНЫЕ ОБЯЗАТЕЛЬСТВА', 'Заемные средства', '1410', 'Отложенные налоговые обязательства', '-', '-', '1420', '-', 'Оценочные обязательства', '-', '1430', 'Прочие обязательства', '-', '-', '1450', 'Итого по разделу IV', '-', '-', '1400', '-', '-', 'V. КРАТКОСРОЧНЫЕ ОБЯЗАТЕЛЬСТВА', 'Заемные средства', '1510', '20000', '943', '-', 'в том числе:', 'Краткосрочные займы', '15101', '20 000', '943', '-', 'Кредиторская задолженность', '1520', '3147 148', '2635 071', '2411 555', 'в том числе:', 'Расчеты с поставщиками и подрядчиками', '15201', '1426 910', '1401 885', '1 139 830', 'Расчеты с покупателями и заказчиками', '15202', '1 556 167', '1 079184', '1 123 885', 'Расчеты по налогам и сборам', '15203', '10 068', '5272', '1202', 'Расчеты по социальному страхованию и', '15204', 'обеспечению', '590', '387', '382', 'Расчеты с персоналом по оплате труда', '15205', '1742', '81', '1158', 'Расчеты с подотчетными лицами', '15206', '-', '-', '314', 'Расчеты с разными дебиторами и', '15207', 'кредиторами', '151671', '148 262', '144784', 'Доходы будущих периодов', '1530', '-', '-', ',', 'Оценочные обязательства', '1540', '-', '-', 'Прочие обязательства', '1550', '-', '-', 'Итого по разделу V', '1500', '3147148', '2 655 071', '2412498', '5ААHC', '1700', '3 556 528', '3 060 009', '2813431', '66', 'W', 'Иванова Татьяна', '2', 'Николаевна', '(поддись', '(расшифровка подписи)'],
      ['Отчет о финансовых результатах', 'Коды', 'за Январь - Март 2024 г.', 'Форма по ОКУД', '0710002', '31', '03', '2024', 'Дата (число, месяц, год)', 'по ОКПО', '57932545', 'Организация', 'Акционерное общество "ПРОммОНТАЖСТРОЙ"', 'ИHH', '7805235431', 'Идентификационный номер налогоплательщика', 'Вид экономической', 'Работы строительные специализированные, не включенные в', 'по', '43.99.5', 'оквэд2', 'деятельности', 'другие группировки', 'Организационно-правовая форма/форма собственности', '12267', '16', 'Непубличные акционерные', 'по ОКОПФ/ОКФС', 'общества', '/Частная собственность', 'Единица измерения:', 'по ОКЕИ', '384', 'в тыс. рублей', 'За Январь - Март', 'За Январь - Март', 'Пояснения', 'Код', 'Наименование показателя', '2024г.', '2023г.', 'Выручkа', '2110', '255 880', '209371', 'Себестоимость продаж', '2120', '(228 877)', '(174 896)', 'Валовая прибыль (убыток)', '2100', '27 003', '34 475', 'Коммерческие расходы', '2210', '-', 'Управленческие расходы', '2220', '(11 802)', '(9 031)', 'Прибыль (убыток) от продаж', '2200', '15201', '25444', 'Доходы от участия в других организациях', '2310', '-', 'Проценты к получению', '2320', '-', '-', 'Проценты к уплате', '2330', '-', 'Прочие доходы', '2340', '19 996', '5552', 'в том числе:', 'Доходы, связанные с реализацией основных', '23401', 'средств', '200', '661', 'Доходы по операциям с финансовыми', 'инструментами срочных сделок,не', '23402', 'обращающимися на организованном рынке', '-', 'Прочие операционные доходы', '23403', '-', '122', 'Штрафы, пени, неустойки к получению', '23404', '420', 'Доходы в виде списанной кредиторской', '23405', 'задолженности', '19376', '4769', 'Прочие внереализационные доходы', '23406', '-', '-', 'Прочие расходы', '2350', '(29 490)', '(30 399)', 'в том числе:', 'Расходы, связанные с реализацией основных', '23501', 'средств', '(2)', '-', 'Расходы по операциям с финансовыми', 'инструментами срочных сделок,не', '23502', '', '1', '-', 'Расходы на услуги банков', '23503', '(729)', '(7949)', 'Прочие операционные расходы', '23504', '(19 349)', '(21478)', 'Штрафы, пени, неустойки к уплате', '23505', '(330)', '(1)', 'Налоги и сборы', '23506', '(7852)', '(24)', 'Расходы в виде списанной дебиторской', '23507', 'задолженности', '(770)', '(447)', 'Прочие внереализационные расходы', '23508', '(458)', '(500)', 'Прочие косвенные расходы', '23509', '-', '-', 'Прибыль(убыток) до налогообложения', '2300', '5707', '597', 'Налог на прибыль', '2410', '(1264)', '(184)', 'в том числе:', 'текущий налог на прибыль', '2411', '(1264)', '(184)', 'отложенный налог на прибыль', '2412', '-', '-', 'Прочее', '2460', '-', 'Чистая прибыль (убыток)', '2400', '4443', '413'],
      ['Форма 0710002 с.2', 'Пояснения', 'Наименование показателя', 'Код', 'За Январь - Март', 'За Январь - Март', '2024г.', '2023г.', 'Результат от переоценки внеоборотных активов, не', '2510', 'включаемый в чистую прибыль (убыток) периода', '-', 'Результат от прочих операций, не включаемый', '2520', 'в чистую прибыль (убыток) периода', '-', 'Налог на прибыль от операций, результат которых', '2530', 'не включается в чистую прибыль (убыток) периода', '-', 'Совокупный финансовый результат периода', '2500', '4443', '413', 'Справочно', '2900', 'Базовая прибыль (убыток) на акцию', '-', '2910', '-', 'Разводненная прибыль (убыток) на акцию', '-', 'Строй', 'ИвановаТатьяна', 'КОводитель', 'Николаевна', '(подрись)', '(расшифровка подписи)', 'p6ypT']
    ];

    // Объединяем все строки из всех страниц
    const allRawStrings = rawStrings.flat();
    
    const codesFoundInRaw = codes.filter(code => allRawStrings.includes(code));
    console.log('Коды, найденные в rawStrings:', codesFoundInRaw);
    expect(codesFoundInRaw.length).toBeGreaterThan(0);

    const { otchetnost, error } = parsePageContent(rawStrings);
    console.log('Результат parsePageContent:', { error, otchetnostLength: otchetnost?.length });
    if (otchetnost && otchetnost.length > 0) {
      console.log('Первые 5 элементов otchetnost:', otchetnost.slice(0, 5));
    }
    
    expect(error).toBeUndefined();
    expect(Array.isArray(otchetnost)).toBe(true);

    const parsedCodes = new Set(otchetnost.map(r => r.code));
    const missingParsed = codesFoundInRaw.filter(code => !parsedCodes.has(code));

    if (missingParsed.length > 0) {
      console.error('Коды, найденные в raw.txt, но не спарсенные:', missingParsed);
    }

    expect(missingParsed).toEqual([]);
  });
});
