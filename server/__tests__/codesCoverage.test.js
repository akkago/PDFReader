const { parsePageContent } = require('../parsePageContent');

describe('codes.txt coverage in raw.txt and parsePageContent', () => {
  test('все коды, которые присутствуют в raw.txt, спарсены parsePageContent', () => {
    const codes = ['1110', '1120', '1130', '1140', '1150', '11501', '11502', '1160', '1170', '11701', '1180', '1190', '1100', '1210', '12101', '12102', '12103', '1220', '12201', '12202', '1230', '12301', '12302', '12303', '12304', '12305', '12306', '1240', '12401', '1250', '12501', '12502', '1260', '12601', '1200', '1600', '1310', '1320', '1340', '1350', '1360', '1370', '1300', '1410', '1420', '1430', '1450', '1400', '1510', '15101', '1520', '15201', '15202', '15203', '15204', '15205', '15206', '15207', '1530', '1540', '1550', '1500', '1700'];
    const rawStrings = [
      ['Бухгалтерский баланс', 'на 30 сентября 2024 г.', 'Коды', 'Форма по ОКУД', '0710001', 'Дата (число, месяц, год)', '30', '09', '2024', 'Организация', 'Акционерное общество "ПРОММОНТАЖСТРОЙ"', 'по ОКПО', '57932545', 'ф', 'ИHH', '7805235431', 'Вид экономической', 'Работы строительные специализированные, не включенные в', 'по', 'оквэд 2', '43.99.5', 'деятельности', 'другие группировки', 'Организационно-правовая форма /форма собственности', 'Непубличные акционерные', '12267', '16', 'общества', 'по ОКОПФ / ОКФС', '/Частная собственность', 'Единица измерения:', 'в тыс. рублей', 'по ОКЕИ', '384', 'Местонахождение (адрес)', '191180, Санкт-Петербург г, Гороховая ул, дом 67, литера А, помещение 14н', 'Бухгалтерская отчетность подлежит обязательному аудиту', 'ДА', 'HET', 'Наименование аудиторской организации/фамилия, имя, отчество (при наличии) индивидуального аудитора', 'Идентификационный номер налогоплательщика аудиторской организации/индивидуального', 'IHH', 'аудитора', 'Основной государственный регистрационный номер аудиторской', 'ОГРН/', '', 'ОГРНИП', 'Код', 'На 30 сентября', 'На 31 декабря', 'На 31 декабря', 'Пояснения', 'Наименование показателя', '2024г.', '2023г.', '2022r.', 'АКТИВ', 'I. ВНЕОБОРОТНЫЕ АКТИВЫ', 'Нематериальные активы', '1110', '-', 'Результаты исследований и разработок', '1120', '-', '-', '-', 'Нематериальные поисковые активы', '1130', '-', '-', '-', 'Материальные поисковые активы', '1140', '-', '-', 'Основные средства', '1150', '37 992', '24100', '26 048', 'в том числе:', 'Основные средства в организации', '11501', '32 992', '19 100', '21 048', 'Права пользования активами', '11502', '5000', '5000', '5000', 'Доходные вложения в материальные', '1160', 'ценности', '.', '-', 'Финансовые вложения', '1170', '95653', '95653', '95653', 'в том числе:', 'Паи', '11701', '95653', '95653', '95653', 'Отложенные налоговые активы', '1180', '-', '-', '-', 'Прочие внеоборотные активы', '1190', '-', '-', 'Итого по разделу 1', '1100', '133645', '119 753', '121701', 'II. ОБОРОТНЫЕ АКТИВЫ', 'Запасы', '1210', '1 404 416', '919 272', '852699', 'в том числе:', 'Материалы', '12101', '97 528', '78 834', '78 580', 'Товары', '12102', '5467', '5 467', '188', 'Основное производство', '12103', '1301 421', '834 971', '773 931', 'Налог на добавленную стоимость по', '1220', 'приобретенным ценностям', '723', '-', '-', 'в том числе:', 'НДС по приобретенным', '12201', '-', '696', 'материально-производственным запасам', '-'],
      ['НДС по приобретенным услугам', '12202', '27', '-', '-', 'Дебиторская задолженность', '1230', '2 040 731', '1 450 868', '1417123', 'в том числе:', 'Расчеты с поставщиками и подрядчиками', '12301', '1531 194', '1 120 054', '762725', 'Расчеты с покупателями и заказчиками', '12302', '453 915', '288 733', '619 211', 'Расчеты по налогам и сборам', '12303', '3693', '228', '877', 'Расчеты с подотчетными лицами', '12304', '9', '-', '-', 'Расчеты с персоналом по прочим', '12305', 'операциям', '550', '550', '550', 'Расчеты с разными дебиторами и', '12306', 'кредиторами', '51370', '41303', '33 760', 'Финансовые вложения (за исключением', '1240', '48 926', '78 926', '49 926', 'денежных эквивалентов)', 'в том числе:', '12401', 'Предоставленные займы', '48 926', '78 926', '49 926', 'Денежные средства и денежные', '1250', '328 700', '470108', '309 607', 'эквиваленты', 'в том числе:', '12501', '324 022', '467390', '309 489', 'Расчетные счета', '12502', '4678', '2718', '118', 'Прочие специальные счета', '1260', '13 075', '21082', '61652', 'Прочие оборотные активы', 'в том числе:', '12601', '21082', '61652', 'Расходы будущих периодов', '13 075', '2940256', '2691730', 'Итого по разделу II', '1200', '3 835 848', '3 060 009', '2813431', '5АAHC', '1600', '3 969 493'],
      ['Форма 0710001 с.2', 'Пояснения', 'Код', 'На 30 сентября', 'Наименование показателя', 'На 31 декабря', 'На 31 декабря', '2024г.', '2023 г.', '2022r.', 'ПАССИВ', 'III. КАПИТАЛ И РЕЗЕРВЫ', 'Уставный капитал (складочный капитал,', '1310', 'уставный фонд, вклады товарищей)', '210', '210', '210', 'Собственные акции, выкупленные у', '1320', 'акционеров', 'Переоценка внеоборотных активов', '-', '-', '1340', '-', 'Добавочный капитал(без переоценки)', '-', '-', '1350', '372100', '372 100', '372100', 'Резервный капитал', '1360', '-', '-', 'Нераспределенная прибыль(непокрытый', '-', 'убыток)', '1370', '39 645', '32628', '28623', 'Итого по разделу II', '1300', '411 955', '404938', '400933', 'IV. ДОЛГОСРОЧНЫЕ ОБЯЗАТЕЛЬСТВА', 'Заемные средства', '1410', 'Отложенные налоговые обязательства', '-', '-', '1420', '-', '-', 'Оценочные обязательства', '1430', '-', 'Прочие обязательства', '-', '1450', 'Итого по разделу IV', '-', '-', '1400', '-', 'V. КРАТКОСРОЧНЫЕ ОБЯЗАТЕЛЬСТВА', 'Заемные средства', '1510', '20 000', '943', 'в том числе:', '-', 'Краткосрочные займы', '15101', '20 000', '943', '-', 'Кредиторская задолженность', '1520', '3 557538', '2635 071', '2411 555', 'в том числе:', 'Расчеты с поставщиками и подрядчиками', '15201', '1575 741', '1401 885', '1 139 830', 'Расчеты с покупателями и заказчиками', '15202', '1812979', '1 079 184', '1 123 885', 'Расчеты по налогам и сборам', '15203', '6990', '5272', '1202', 'Расчеты по социальному страхованию и', '15204', 'обеспечению', '526', '387', '382', 'Расчеты с персоналом по оплате труда', '15205', '1482', '81', '1158', 'Расчеты с подотчетными лицами', '15206', '-', '-', '314', 'Расчеты с разными дебиторами и', '15207', 'кредиторами', '159 820', '148 262', '144784', 'Доходы будущих периодов', '1530', '-', '-', 'Оценочные обязательства', '-', '1540', '-', '-', 'Прочие обязательства', '1550', '-', '-', 'Итого по разделу V', '1500', '3557 538', '2655 071', '2412498', '5АAHC', '1700', '3 969 493', '3 060 009', '2813431', 'F', 'ОГРH', 'Руководитель', 'Иванова Татьяна', '(подпись)', 'Николаевна', '(расшифровка подписи)']
    ];

    const allStrings = rawStrings.flat();
    const codesFoundInRaw = codes.filter(code => allStrings.includes(code));
    expect(codesFoundInRaw.length).toBeGreaterThan(0);

    const pageContents = rawStrings;
    const { otchetnost, error } = parsePageContent(pageContents);
    expect(error).toBeUndefined();
    expect(Array.isArray(otchetnost)).toBe(true);

    const parsedCodes = new Set(otchetnost.map(r => r.code));
    const missingParsed = codesFoundInRaw.filter(code => !parsedCodes.has(code));

    expect(missingParsed).toEqual([]);
  });
});


