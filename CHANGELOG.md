# Журнал изменений

## [2.0.0] - 2024-01-XX

### Добавлено
- 🔄 **Асинхронная обработка файлов** - файлы теперь обрабатываются в фоне с возможностью отслеживания статуса
- 📋 **Система типов документов** - поддержка различных типов файлов (отчетность)
- ✅ **Валидация содержимого** - проверка соответствия содержимого файла указанному типу
- 🆔 **Система заявок** - каждому файлу присваивается уникальный ID для отслеживания
- 📊 **Отслеживание статуса** - реальное время отображения прогресса обработки

### Изменено
- 🔄 **API полностью переработан**:
  - `POST /api/upload` → `POST /api/parse`
  - Добавлен `GET /api/result/:id`
- 📝 **Структура запросов**:
  - Обязательный параметр `type` для указания типа документа
  - Поле файла изменено с `pdf` на `file`
- 📊 **Структура ответов**:
  - Асинхронные ответы с ID заявки
  - Статусы: `in_progress`, `complete`, `failed`
  - Детальные сообщения об ошибках

### Удалено
- ❌ Синхронная обработка файлов
- ❌ Прямое возвращение результатов в ответе на загрузку

### Технические изменения
- ➕ Добавлена зависимость `uuid` для генерации уникальных ID
- 🔧 Переработана логика обработки файлов в `server/index.js`
- 🎨 Обновлен интерфейс для поддержки асинхронной обработки
- 📚 Добавлена документация API в `API_GUIDE.md`
- 🧪 Созданы тесты API в `test-api.js`

### Поддерживаемые типы файлов
- `otchetnost` - Финансовая отчетность (баланс, ОФР)

### Валидация
Система проверяет наличие ключевых слов в содержимом:
- Для `otchetnost`: "баланс", "отчет", "форма", "окуд", "актив", "пассив", "код"

### Обратная совместимость
❌ **НЕ ОБРАТНО СОВМЕСТИМО** - API полностью переработан

### Миграция
Для обновления существующих интеграций:
1. Измените эндпоинт с `/api/upload` на `/api/parse`
2. Добавьте обязательный параметр `type`
3. Реализуйте polling для получения результатов через `/api/result/:id`
4. Обработайте новые статусы и ошибки

### Пример миграции

**Старый код:**
```javascript
const response = await axios.post('/api/upload', formData);
const result = response.data; // Прямой результат
```

**Новый код:**
```javascript
const response = await axios.post('/api/parse', formData);
const requestId = response.data.request_id;

// Polling для получения результата
let status = 'in_progress';
while (status === 'in_progress') {
  await new Promise(resolve => setTimeout(resolve, 2000));
  const statusResponse = await axios.get(`/api/result/${requestId}`);
  status = statusResponse.data.status;
  
  if (status === 'complete') {
    const result = statusResponse.data.content;
    break;
  }
}
```
