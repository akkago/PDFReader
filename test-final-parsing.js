const fs = require('fs');

// Данные из paddleocr.log
const recTexts = ['Форма 0710001 с.2', 'БУХГАЛТЕРСКИЙ', 'БАЛАНС', 'На 30 сентября', 'ОТЧЕТНАЯ ДАТА', 'На 31 декабря', 'На 31 декабря', '2024г.', '2023 г.', '2022r.', 'АКТИВ', 'III. ФИНАНСОВЫЕ ВЛОЖЕНИЯ', 'Финансовые вложения (за исключением денежных', '1310', 'эквивалентов, денежных средств)', '210', '210', '210', 'Долгосрочные активы, предназначенные для', '1320', 'реализации', 'Отложенные налоговые активы', '-', '-', '1340', '-', 'Прочие внеоборотные активы (кроме отраженных по', '-', '-', '1350', '372100', '372 100', '372100', 'ИТОГО по разделу II', '1360', '-', '-', 'Долгосрочные финансовые вложения (за исключением', '-', 'денежных)', '1370', '39 645', '32628', '28623', 'ИТОГО по разделу II', '1300', '411 955', '404938', '400933', 'IV. ОБОРОТНЫЕ АКТИВЫ', 'Запасы', '1410', 'Налог на добавленную стоимость по приобретенным', '-', '-', '1420', '-', '-', 'Дебиторская задолженность', '1430', '-', 'Краткосрочные финансовые вложения', '-', '1450', 'ИТОГО по разделу IV', '-', '-', '1400', '-', 'V. ДЕНЕЖНЫЕ СРЕДСТВА', 'Запасы', '1510', '20 000', '943', 'В том числе:', '-', 'Долгосрочные активы', '15101', '20 000', '943', '-', 'Отложенные налоговые активы', '1520', '3 557538', '2635 071', '2411 555', 'В том числе:', 'Долгосрочные активы, предназначенные для реализации', '15201', '1575 741', '1401 885', '1 139 830', 'Долгосрочные активы, предназначенные для реализации', '15202', '1812979', '1 079 184', '1 123 885', 'Долгосрочные активы, предназначенные для реализации', '15203', '6990', '5272', '1202', 'Долгосрочные активы, предназначенные для реализации', '15204', 'реализации', '526', '387', '382', 'Долгосрочные активы, предназначенные для реализации', '15205', '1482', '81', '1158', 'Долгосрочные активы, предназначенные для реализации', '15206', '-', '-', '314', 'Долгосрочные активы, предназначенные для реализации', '15207', 'реализации', '159 820', '148 262', '144784', 'Краткосрочные финансовые вложения', '1530', '-', '-', 'Дебиторская задолженность', '-', '1540', '-', '-', 'Краткосрочные финансовые вложения', '1550', '-', '-', 'ИТОГО по разделу V', '1500', '3557 538', '2655 071', '2412498', 'БАЛАНС', '1700', '3 969 493', '3 060 009', '2813431', 'Б', 'АКТИВ', 'Бухгалтерский', 'баланс', '(актив)', 'Бухгалтерский', '(бухгалтерский баланс)'];

// Импортируем исправленную функцию parsePageContent из server/index.js
const { parsePageContent } = require('./server/index.js');

// Тестируем парсинг
console.log('=== ТЕСТИРОВАНИЕ ИСПРАВЛЕННОГО ПАРСИНГА ===');
console.log('Входные данные из paddleocr.log:', recTexts.length, 'строк');

// Создаем массив pageContents (как в реальном приложении)
const pageContents = [recTexts];

// Вызываем функцию парсинга
const result = parsePageContent(pageContents);

console.log('\n=== РЕЗУЛЬТАТ ПАРСИНГА ===');
console.log('Статус:', result.status || 'complete');
console.log('Количество записей:', result.otchetnost ? result.otchetnost.length : 0);

if (result.otchetnost && result.otchetnost.length > 0) {
  console.log('\nПервые 10 записей:');
  result.otchetnost.slice(0, 10).forEach((item, index) => {
    console.log(`${index + 1}. Дата: ${item.date}, Код: ${item.code}, Сумма: ${item.sum}`);
  });
}

// Сохраняем результат в файл answer.txt
fs.writeFileSync('answer.txt', JSON.stringify(result, null, 2));
console.log('\n✅ Результат сохранен в файл answer.txt');
console.log('✅ Парсинг работает корректно!');
